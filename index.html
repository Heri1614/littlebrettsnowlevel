<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LittleBrett Snow Level</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
    }
    #startButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }
  </style>
</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script>
    let bg;
    let player;
    let platforms = [];
    let startGame = false;

    function preload() {
      bg = loadImage("bg_forest.png");

      player = {
        img: {
          idle: loadImage("brett_idle.png"),
          walk: loadImage("brett_walk1.png"),
          jump: loadImage("brett_jump.png"),
          fall: loadImage("brett_fall.png"),
          down: loadImage("brett_down.png"),
          happy: loadImage("brett_happy.png")
        },
        x: 100,
        y: 0,
        w: 50,
        h: 50,
        vx: 0,
        vy: 0,
        grounded: false
      };

      platforms.push({ img: loadImage("Platform_small.png"), x: 50, y: 300 });
      platforms.push({ img: loadImage("Platform_tall.png"), x: 200, y: 220 });
      platforms.push({ img: loadImage("Platform_small.png"), x: 350, y: 150 });
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      player.y = height - player.h - 100;
    }

    function draw() {
      background(0);

      if (bg) {
        image(bg, 0, 0, width, height);
      }

      if (!startGame) return;

      // Movimiento
      player.vy += 0.8; // gravedad
      player.y += player.vy;
      player.x += player.vx;

      // LÃ­mite de pantalla
      if (player.x < 0) player.x = 0;
      if (player.x + player.w > width) player.x = width - player.w;

      player.grounded = false;

      for (let plat of platforms) {
        image(plat.img, plat.x, plat.y);

        if (
          player.x + player.w > plat.x &&
          player.x < plat.x + plat.img.width &&
          player.y + player.h > plat.y &&
          player.y + player.h < plat.y + 20 &&
          player.vy >= 0
        ) {
          player.y = plat.y - player.h;
          player.vy = 0;
          player.grounded = true;
        }
      }

      let sprite = player.img.idle;
      if (!player.grounded) sprite = player.vy < 0 ? player.img.jump : player.img.fall;
      else if (player.vx !== 0) sprite = player.img.walk;

      image(sprite, player.x, player.y, player.w, player.h);
    }

    function keyPressed() {
      if (keyCode === LEFT_ARROW) player.vx = -5;
      if (keyCode === RIGHT_ARROW) player.vx = 5;
      if (keyCode === UP_ARROW && player.grounded) {
        player.vy = -15;
      }
    }

    function keyReleased() {
      if (keyCode === LEFT_ARROW || keyCode === RIGHT_ARROW) {
        player.vx = 0;
      }
    }

    function mousePressed() {
      if (!startGame) startGame = true;
    }
  </script>
</body>
</html>
