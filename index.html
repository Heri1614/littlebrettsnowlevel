<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LittleBrett Snow Level</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { overflow: hidden; height: 100%; background: #000; }
    canvas { display: block; background: #000; }
    #controls { position: fixed; bottom: 10px; width: 100%; display: flex; justify-content: space-around; }
    #controls img { width: 60px; height: auto; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="controls">
    <img id="btnLeft" src="btn_left.png" />
    <img id="btnJump" src="btn_jump.png" />
    <img id="btnRight" src="btn_right.png" />
  </div>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;const images = {};
const loadImage = (name, src) => {
  return new Promise((resolve) => {
    const img = new Image();
    img.src = src;
    img.onload = () => {
      images[name] = img;
      resolve();
    };
  });
};

const loadAllImages = async () => {
  const assets = [
    ["bg", "bg_forest.png"],
    ["platform", "platform_ice.png"],
    ["brett", "brett_idle.png"],
    ["brett_jump", "brett_jump.png"],
    ["brett_fall", "brett_fall.png"],
    ["brett_happy", "brett_happy.png"],
    ["brett_down", "brett_down.png"],
    ["enemy", "enemy1.png"]
  ];
  await Promise.all(assets.map(([name, src]) => loadImage(name, src)));
};

const keys = { left: false, right: false, jump: false };

document.getElementById("btnLeft").ontouchstart = () => keys.left = true;
document.getElementById("btnLeft").ontouchend = () => keys.left = false;
document.getElementById("btnRight").ontouchstart = () => keys.right = true;
document.getElementById("btnRight").ontouchend = () => keys.right = false;
document.getElementById("btnJump").ontouchstart = () => keys.jump = true;
document.getElementById("btnJump").ontouchend = () => keys.jump = false;

const player = {
  x: 50,
  y: 0,
  width: 50,
  height: 50,
  dx: 0,
  dy: 0,
  grounded: false,
  sprite: "brett"
};

const gravity = 0.5;
const jumpPower = -12;
const speed = 5;

const platforms = [];
for (let i = 0; i < 40; i++) {
  const x = i * 150;
  const y = canvas.height - 100 - Math.sin(i * 0.5) * 50;
  platforms.push({ x, y, width: 100, height: 20 });
}

const enemies = [
  { x: 500, y: canvas.height - 160, width: 50, height: 50 }
];

let gameOver = false;
let gameWin = false;

const update = () => {
  if (gameOver || gameWin) return;
  player.dx = 0;
  if (keys.left) player.dx = -speed;
  if (keys.right) player.dx = speed;
  if (keys.jump && player.grounded) {
    player.dy = jumpPower;
    player.grounded = false;
  }

  player.dy += gravity;
  player.x += player.dx;
  player.y += player.dy;

  // Collision con plataformas
  player.grounded = false;
  for (const p of platforms) {
    if (
      player.x < p.x + p.width &&
      player.x + player.width > p.x &&
      player.y + player.height > p.y &&
      player.y + player.height < p.y + p.height + 10 &&
      player.dy >= 0
    ) {
      player.y = p.y - player.height;
      player.dy = 0;
      player.grounded = true;
    }
  }

  // Enemigo
  for (const e of enemies) {
    if (
      player.x < e.x + e.width &&
      player.x + player.width > e.x &&
      player.y < e.y + e.height &&
      player.y + player.height > e.y
    ) {
      gameOver = true;
    }
  }

  // Final del juego
  if (player.x > platforms[platforms.length - 1].x) {
    gameWin = true;
  }
};

const draw = () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(images.bg, 0, 0, canvas.width, canvas.height);

  const offsetX = player.x - 100;

  platforms.forEach(p => {
    ctx.drawImage(images.platform, p.x - offsetX, p.y, p.width, p.height);
  });

  enemies.forEach(e => {
    ctx.drawImage(images.enemy, e.x - offsetX, e.y, e.width, e.height);
  });

  if (gameOver) {
    ctx.drawImage(images.brett_down, canvas.width / 2 - 100, canvas.height / 2 - 100);
    return;
  }
  if (gameWin) {
    ctx.drawImage(images.brett_happy, canvas.width / 2 - 100, canvas.height / 2 - 100);
    return;
  }

  const sprite = player.dy < 0 ? "brett_jump" : player.dy > 2 ? "brett_fall" : "brett";
  ctx.drawImage(images[sprite], player.x - offsetX, player.y, player.width, player.height);
};

const loop = () => {
  update();
  draw();
  requestAnimationFrame(loop);
};

loadAllImages().then(() => loop());

  </script>
</body>
</html>
