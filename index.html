<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LittleBrett Snow Level</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: black;
    }
    canvas {
      display: block;
      margin: auto;
      background-color: black;
    }
    #startButton {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: url('btn_start.png') no-repeat center center;
      background-size: contain;
      width: 200px;
      height: 80px;
      border: none;
      cursor: pointer;
    }
    .control-button {
      position: absolute;
      bottom: 20px;
      width: 70px;
      height: 70px;
      background-size: contain;
      background-repeat: no-repeat;
      background-color: transparent;
      border: none;
    }
    #leftButton {
      left: 20px;
      background-image: url('btn_left.png');
    }
    #rightButton {
      left: 100px;
      background-image: url('btn_right.png');
    }
    #jumpButton {
      right: 20px;
      background-image: url('btn_jump.png');
    }
  </style>
</head>
<body>
  <button id="startButton"></button>
  <button class="control-button" id="leftButton"></button>
  <button class="control-button" id="rightButton"></button>
  <button class="control-button" id="jumpButton"></button>

  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let gameStarted = false;
    let images = {};
    let keys = {};
    let player = {
      x: 100, y: 420, width: 50, height: 50,
      vx: 0, vy: 0, jumping: false, grounded: true,
      frame: 0, frameDelay: 0
    };
    const gravity = 0.5;
    const jumpStrength = -10;
    const platforms = [
      { x: 0, y: 500, type: 'PlatformTall' },
      { x: 200, y: 520, type: 'PlatformSmall' },
      { x: 400, y: 500, type: 'PlatformTall' },
      { x: 600, y: 520, type: 'PlatformSmall' },
      { x: 700, y: 500, type: 'PlatformTall' }
    ];
    const coins = [
      { x: 210, y: 480, type: 'coin' },
      { x: 410, y: 460, type: 'btc' },
      { x: 610, y: 480, type: 'eth' }
    ];

    const imageSources = {
      background: 'bg_forest.png',
      PlatformTall: 'PlatformTall.png',
      PlatformSmall: 'PlatformSmall.png',
      brett_idle: 'brett_idle.png',
      brett_walk1: 'brett_walk1.png',
      brett_jump: 'brett_jump.png',
      brett_fall: 'brett_fall.png',
      coin: 'coin.png',
      btc: 'btc.png',
      eth: 'eth.png'
    };

    const loadImages = (sources, callback) => {
      let loaded = 0, total = Object.keys(sources).length;
      for (let key in sources) {
        images[key] = new Image();
        images[key].src = sources[key];
        images[key].onload = () => {
          loaded++;
          if (loaded === total) callback();
        };
      }
    };

    const draw = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(images.background, 0, 0, canvas.width, canvas.height);

      platforms.forEach(p => {
        ctx.drawImage(images[p.type], p.x, p.y);
      });

      coins.forEach(c => {
        ctx.drawImage(images[c.type], c.x, c.y);
      });

      let sprite = images.brett_idle;
      if (!player.grounded) sprite = player.vy < 0 ? images.brett_jump : images.brett_fall;
      else if (player.vx !== 0) sprite = images.brett_walk1;
      ctx.drawImage(sprite, player.x, player.y);
    };

    const update = () => {
      if (keys['ArrowLeft']) player.vx = -3;
      else if (keys['ArrowRight']) player.vx = 3;
      else player.vx = 0;

      if (!player.grounded) player.vy += gravity;
      player.x += player.vx;
      player.y += player.vy;

      player.grounded = false;
      platforms.forEach(p => {
        if (player.x < p.x + 100 && player.x + player.width > p.x &&
            player.y + player.height < p.y + 20 && player.y + player.height + player.vy >= p.y) {
          player.y = p.y - player.height;
          player.vy = 0;
          player.jumping = false;
          player.grounded = true;
        }
      });

      draw();
      requestAnimationFrame(update);
    };

    document.getElementById('startButton').onclick = () => {
      document.getElementById('startButton').style.display = 'none';
      gameStarted = true;
      update();
    };

    window.addEventListener('keydown', e => {
      keys[e.key] = true;
      if (e.key === ' ' && player.grounded) {
        player.vy = jumpStrength;
        player.jumping = true;
      }
    });

    window.addEventListener('keyup', e => keys[e.key] = false);

    document.getElementById('leftButton').ontouchstart = () => keys['ArrowLeft'] = true;
    document.getElementById('rightButton').ontouchstart = () => keys['ArrowRight'] = true;
    document.getElementById('jumpButton').ontouchstart = () => {
      if (player.grounded) {
        player.vy = jumpStrength;
        player.jumping = true;
      }
    };
    document.getElementById('leftButton').ontouchend = () => keys['ArrowLeft'] = false;
    document.getElementById('rightButton').ontouchend = () => keys['ArrowRight'] = false;

    loadImages(imageSources, () => {
      draw();
    });
  </script>
</body>
</html>
