<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LittleBrett Snow Level</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
    }
    .control-btn {
      position: fixed;
      bottom: 20px;
      width: 60px;
      height: 60px;
      background: none;
      border: none;
    }
    #leftBtn {
      left: 20px;
    }
    #rightBtn {
      left: 100px;
    }
    #jumpBtn {
      right: 20px;
    }
    #invokeBtn {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      width: 80px;
    }
  </style>
</head>
<body>
  <button id="leftBtn" class="control-btn"><img src="btn_left.png" width="60" height="60" /></button>
  <button id="rightBtn" class="control-btn"><img src="btn_right.png" width="60" height="60" /></button>
  <button id="jumpBtn" class="control-btn"><img src="btn_jump.png" width="60" height="60" /></button>
  <img id="invokeBtn" src="invoke_btn.png" />  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>  <script>
let brett, brettImg = {}, coinImg, coins = [], score = 0;
let platformImg, platforms = [];
let bg;
let gravity = 1, velocityY = 0;
let onGround = false;
let leftPressed = false, rightPressed = false;
let invokeBtn, canInvoke = false;
let bull, bullImg;
let enemies = [], enemyImg;
let gameOver = false, gameWon = false;

function preload() {
  bg = loadImage("bg_forest.png");
  brettImg.idle = loadImage("brett_idle.png");
  brettImg.jump = loadImage("brett_jump.png");
  brettImg.fall = loadImage("brett_fall.png");
  brettImg.happy = loadImage("brett_happy.png");
  brettImg.down = loadImage("brett_down.png");
  coinImg = loadImage("coin.png");
  bullImg = loadImage("bull_fire.png");
  enemyImg = loadImage("enemy1.png");
  platformImg = loadImage("platform_ice.png");
}

function setup() {
  createCanvas(windowWidth, windowHeight);
  brett = createSprite(width/2, height - 150);
  brett.addImage("idle", brettImg.idle);
  brett.addImage("jump", brettImg.jump);
  brett.addImage("fall", brettImg.fall);
  brett.addImage("happy", brettImg.happy);
  brett.addImage("down", brettImg.down);
  brett.changeImage("idle");
  brett.scale = 0.7;

  for (let i = 0; i < 50; i++) {
    let x = i * 150;
    let y = height - random(100, 300);
    let p = createSprite(x, y);
    p.addImage(platformImg);
    platforms.push(p);

    if (random() > 0.6) {
      let c = createSprite(x, y - 50);
      c.addImage(coinImg);
      c.scale = 0.5;
      c.coinType = random(["coin", "btc", "eth"]);
      coins.push(c);
    }
  }

  for (let i = 3; i < 50; i += 8) {
    let e = createSprite(i * 150, height - 140);
    e.addImage(enemyImg);
    e.scale = 0.7;
    enemies.push(e);
  }

  invokeBtn = select('#invokeBtn');
  invokeBtn.mousePressed(invokeBull);

  select('#leftBtn').mousePressed(() => leftPressed = true);
  select('#rightBtn').mousePressed(() => rightPressed = true);
  select('#jumpBtn').mousePressed(jump);
  select('#leftBtn').mouseReleased(() => leftPressed = false);
  select('#rightBtn').mouseReleased(() => rightPressed = false);
}

function draw() {
  background(bg);

  if (gameOver) {
    brett.changeImage("down");
    drawSprites();
    return;
  }
  if (gameWon) {
    brett.changeImage("happy");
    drawSprites();
    return;
  }

  if (leftPressed) brett.position.x -= 5;
  if (rightPressed) brett.position.x += 5;

  brett.position.y += velocityY;
  velocityY += gravity;

  onGround = false;
  for (let p of platforms) {
    if (brett.collide(p)) {
      onGround = true;
      velocityY = 0;
      brett.position.y = p.position.y - brett.height / 2;
    }
  }

  if (brett.position.y > height + 100) {
    gameOver = true;
  }

  for (let c of coins) {
    if (brett.overlap(c)) {
      score += 50;
      c.remove();
    }
  }

  if (score >= 200 && !canInvoke) {
    canInvoke = true;
    invokeBtn.show();
  }

  for (let e of enemies) {
    if (brett.overlap(e)) {
      gameOver = true;
    }
  }

  if (brett.position.x > platforms[platforms.length - 1].position.x + 50) {
    gameWon = true;
  }

  drawSprites();
}

function jump() {
  if (onGround) {
    velocityY = -18;
  }
}

function invokeBull() {
  bull = createSprite(-100, height - 140);
  bull.addImage(bullImg);
  bull.scale = 0.8;
  bull.setSpeed(10, 0);
  invokeBtn.hide();

  bull.overlap(enemies, (b, e) => {
    e.remove();
  });
}
  </script></body>
</html>
