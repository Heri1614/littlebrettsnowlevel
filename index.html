<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LittleBrett Snow Level</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: black;
      touch-action: manipulation;
    }
    canvas {
      display: block;
    }
    #controls {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .btn {
      width: 64px;
      height: 64px;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      border: none;
      outline: none;
      background-color: transparent;
    }
    .btn-left { background-image: url('btn_left.png'); }
    .btn-right { background-image: url('btn_right.png'); }
    .btn-jump { background-image: url('btn_jump.png'); }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="controls">
    <button class="btn btn-left" ontouchstart="keys.left = true" ontouchend="keys.left = false"></button>
    <button class="btn btn-right" ontouchstart="keys.right = true" ontouchend="keys.right = false"></button>
    <button class="btn btn-jump" ontouchstart="jump()" ontouchend="keys.up = false"></button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    const keys = { left: false, right: false, up: false };

    let images = {};
    const loadImages = (sources, callback) => {
      let loaded = 0;
      const total = Object.keys(sources).length;
      for (let key in sources) {
        images[key] = new Image();
        images[key].src = sources[key];
        images[key].onload = () => {
          loaded++;
          if (loaded === total) callback();
        };
      }
    };

    const sources = {
      bg: 'bg_forest.png',
      brett: 'brett_idle.png',
      walk: 'brett_walk1.png',
      jump: 'brett_jump.png',
      fall: 'brett_fall.png',
      platform_small: 'Platform_small.png',
      platform_tall: 'Platform_tall.png',
      coin: 'coin.png',
      btc: 'btc.png',
      eth: 'eth.png'
    };

    let brett = {
      x: 100,
      y: 0,
      vx: 0,
      vy: 0,
      width: 64,
      height: 64,
      onGround: false,
      coins: 0
    };

    const gravity = 1;
    const jumpStrength = -15;

    const platforms = [
      { x: 0, y: height - 100, img: 'platform_small' },
      { x: 200, y: height - 140, img: 'platform_tall' },
      { x: 500, y: height - 100, img: 'platform_small' },
      { x: 800, y: height - 140, img: 'platform_tall' }
    ];

    const coins = [
      { x: 210, y: height - 180, img: 'coin' },
      { x: 510, y: height - 140, img: 'btc' },
      { x: 810, y: height - 180, img: 'eth' }
    ];

    function jump() {
      if (brett.onGround) {
        brett.vy = jumpStrength;
        brett.onGround = false;
      }
    }

    function update() {
      if (keys.left) brett.vx = -5;
      else if (keys.right) brett.vx = 5;
      else brett.vx = 0;

      brett.x += brett.vx;
      brett.vy += gravity;
      brett.y += brett.vy;
      brett.onGround = false;

      for (let p of platforms) {
        if (
          brett.x < p.x + 100 &&
          brett.x + brett.width > p.x &&
          brett.y + brett.height < p.y + 30 &&
          brett.y + brett.height + brett.vy >= p.y
        ) {
          brett.y = p.y - brett.height;
          brett.vy = 0;
          brett.onGround = true;
        }
      }

      for (let c of coins) {
        if (
          brett.x < c.x + 32 &&
          brett.x + brett.width > c.x &&
          brett.y < c.y + 32 &&
          brett.y + brett.height > c.y
        ) {
          brett.coins += 100;
          c.x = -1000;
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, width, height);
      ctx.drawImage(images.bg, 0, 0, width * 2, height);

      for (let p of platforms) {
        ctx.drawImage(images[p.img], p.x, p.y);
      }

      for (let c of coins) {
        ctx.drawImage(images[c.img], c.x, c.y, 32, 32);
      }

      let sprite = images.brett;
      if (!brett.onGround) sprite = brett.vy < 0 ? images.jump : images.fall;
      else if (brett.vx !== 0) sprite = images.walk;

      ctx.drawImage(sprite, brett.x, brett.y, brett.width, brett.height);
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    window.addEventListener("keydown", (e) => {
      if (e.code === "ArrowLeft") keys.left = true;
      if (e.code === "ArrowRight") keys.right = true;
      if (e.code === "Space") jump();
    });

    window.addEventListener("keyup", (e) => {
      if (e.code === "ArrowLeft") keys.left = false;
      if (e.code === "ArrowRight") keys.right = false;
    });

    loadImages(sources, () => {
      brett.y = height - 164; // inicio sobre el suelo
      gameLoop();
    });
  </script>
</body>
</html>
