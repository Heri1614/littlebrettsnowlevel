<!DOCTYPE html>
<html>
<head>
  <title>LittleBrett Snow Level</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let images = {};
  const imageNames = [
    "bg_forest", "brett_idle", "brett_walk1", "brett_jump", "brett_fall", "brett_down", "brett_happy",
    "btn_left", "btn_right", "btn_jump", "btn_start",
    "Platform_small", "Platform_tall", "coin", "btc", "eth"
  ];

  let loaded = 0;
  imageNames.forEach(name => {
    const img = new Image();
    img.src = `${name}.png`;
    img.onload = () => {
      loaded++;
      if (loaded === imageNames.length) startMenu();
    };
    images[name] = img;
  });

  let gameStarted = false;
  let player = {
    x: 100,
    y: 0,
    vx: 0,
    vy: 0,
    w: 60,
    h: 60,
    grounded: false
  };

  const gravity = 1;
  const jumpStrength = -18;
  const moveSpeed = 6;

  let keys = { left: false, right: false };
  let platforms = [];
  let coins = [];

  function createLevel() {
    platforms = [
      { x: 0, y: canvas.height - 60, w: canvas.width * 2, h: 60, type: "Platform_small" },
      { x: 400, y: canvas.height - 150, w: 100, h: 40, type: "Platform_tall" },
      { x: 600, y: canvas.height - 250, w: 100, h: 40, type: "Platform_small" },
    ];

    coins = [
      { x: 430, y: canvas.height - 190, type: "coin" },
      { x: 630, y: canvas.height - 290, type: "btc" },
    ];
  }

  function drawStartButton() {
    ctx.drawImage(images["btn_start"], canvas.width / 2 - 50, canvas.height / 2 - 50, 100, 100);
    canvas.addEventListener("click", startGameOnce);
  }

  function startMenu() {
    ctx.drawImage(images["bg_forest"], 0, 0, canvas.width, canvas.height);
    drawStartButton();
  }

  function startGameOnce(e) {
    const x = e.clientX;
    const y = e.clientY;
    const btnX = canvas.width / 2 - 50;
    const btnY = canvas.height / 2 - 50;
    if (x >= btnX && x <= btnX + 100 && y >= btnY && y <= btnY + 100) {
      gameStarted = true;
      createLevel();
      canvas.removeEventListener("click", startGameOnce);
      requestAnimationFrame(gameLoop);
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(images["bg_forest"], 0, 0, canvas.width, canvas.height);

    for (let plat of platforms) {
      ctx.drawImage(images[plat.type], plat.x, plat.y, plat.w, plat.h);
    }

    for (let coin of coins) {
      ctx.drawImage(images[coin.type], coin.x, coin.y, 30, 30);
    }

    ctx.drawImage(images["brett_idle"], player.x, player.y, player.w, player.h);

    drawControls();
  }

  function update() {
    player.vy += gravity;
    player.x += player.vx;
    player.y += player.vy;

    player.grounded = false;
    for (let plat of platforms) {
      if (
        player.x + player.w > plat.x &&
        player.x < plat.x + plat.w &&
        player.y + player.h > plat.y &&
        player.y + player.h < plat.y + plat.h
      ) {
        player.vy = 0;
        player.y = plat.y - player.h;
        player.grounded = true;
      }
    }

    if (player.y > canvas.height) player.y = 0; // Respawn
  }

  function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  function drawControls() {
    ctx.drawImage(images["btn_left"], 40, canvas.height - 80, 60, 60);
    ctx.drawImage(images["btn_right"], 120, canvas.height - 80, 60, 60);
    ctx.drawImage(images["btn_jump"], canvas.width - 100, canvas.height - 80, 60, 60);
  }

  canvas.addEventListener("touchstart", e => {
    for (let t of e.touches) {
      const x = t.clientX;
      const y = t.clientY;
      if (x >= 40 && x <= 100 && y >= canvas.height - 80) keys.left = true;
      if (x >= 120 && x <= 180 && y >= canvas.height - 80) keys.right = true;
      if (x >= canvas.width - 100 && x <= canvas.width - 40 && y >= canvas.height - 80) {
        if (player.grounded) player.vy = jumpStrength;
      }
    }
  });

  canvas.addEventListener("touchend", () => {
    keys.left = false;
    keys.right = false;
  });

  setInterval(() => {
    if (keys.left) player.vx = -moveSpeed;
    else if (keys.right) player.vx = moveSpeed;
    else player.vx = 0;
  }, 20);
</script>
</body>
</html>
