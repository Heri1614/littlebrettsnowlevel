<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LittleBrett Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background-color: black;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
    #startButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 25vw;
      max-width: 300px;
      z-index: 10;
      cursor: pointer;
    }
  </style>
</head>
<body>

<img id="startButton" src="btn_start.png" alt="Start">
<canvas id="gameCanvas"></canvas>
<img id="invokeButton" src="invoke_btn.png" style="display: none; position: absolute; bottom: 20px; left: 20px; width: 70px; cursor: pointer; z-index: 20;">

<script>
const startButton = document.getElementById('startButton');
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Imágenes
const bgForest = new Image(); bgForest.src = 'bg_forest.png';
const brettIdle = new Image(); brettIdle.src = 'brett_idle.png';
const brettWalk = new Image(); brettWalk.src = 'brett_walk1.png';
const brettJump = new Image(); brettJump.src = 'brett_jump.png';
const brettFall = new Image(); brettFall.src = 'brett_fall.png';
const brettDown = new Image(); brettDown.src = 'brett_down.png';
const bullFire = new Image(); bullFire.src = 'bull_fire.png';
const heartFull = new Image(); heartFull.src = 'heart_full.png';
const heartEmpty = new Image(); heartEmpty.src = 'heart_empty.png';
const explosionImg = new Image(); explosionImg.src = 'explosion.png';
const gameOverImg = new Image(); gameOverImg.src = 'gameover.png';
const retryBtn = new Image(); retryBtn.src = 'retry_btn.png';

const enemy = {
  x: 400, y: 460, width: 50, height: 60, speed: 2.5, direction: 1,
  alive: true, exploding: false, explosionTimer: 0,
  img: new Image()
};
enemy.img.src = 'enemy1.png';

let brettX = 400, brettY = 380, velocityY = 0;
let moveLeft = false, moveRight = false;
let isJumping = false, gameStarted = false;
let score = 0, lives = 5, bullCharges = 0;
let bullActive = false, bullX = -200, bullSpeed = 15;
let isInvincible = false, invincibilityTimer = 0;
let gameOver = false, showRetry = false;

const invokeButton = document.getElementById('invokeButton');
invokeButton.onclick = () => {
  if (!bullActive && bullCharges > 0) {
    bullActive = true;
    bullX = -200;
    bullCharges--;
  }
};

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);

// PLATAFORMAS, MONEDAS (omitido aquí por espacio, pero sigue igual...)

startButton.onclick = () => {
  gameStarted = true;
  startButton.style.display = 'none';
  resizeCanvas();
  gameLoop();
};

function drawGame() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(bgForest, 0, 0, canvas.width, canvas.height);

  // (plataformas, monedas, corazones...)

  const brettWidth = canvas.width * 0.1;
  const brettHeight = brettWidth;

  const currentSprite = isJumping
    ? (velocityY < 0 ? brettJump : brettFall)
    : (moveLeft || moveRight ? brettWalk : brettIdle);

  if (!isInvincible || Math.floor(invincibilityTimer / 10) % 2 === 0)
    ctx.drawImage(currentSprite, brettX, brettY, brettWidth, brettHeight);

  if (bullActive)
    ctx.drawImage(bullFire, bullX, canvas.height - 140, 150, 100);

  if (enemy.alive)
    ctx.drawImage(enemy.img, enemy.x, enemy.y, enemy.width, enemy.height);
  else if (enemy.exploding && enemy.explosionTimer > 0) {
    ctx.drawImage(explosionImg, enemy.x, enemy.y, 100, 100);
  }
}

function gameLoop() {
  const speed = 5, gravity = 1.2;
  const brettWidth = canvas.width * 0.1;
  const brettHeight = brettWidth;

  // Movimiento Brett
  if (moveLeft) brettX -= speed;
  if (moveRight) brettX += speed;
  brettX = Math.max(0, Math.min(canvas.width - brettWidth, brettX));
  velocityY += gravity;
  brettY += velocityY;

  // Movimiento enemigo
  if (enemy.alive) {
    enemy.x += enemy.speed * enemy.direction;
    if (enemy.x + enemy.width >= canvas.width) enemy.direction = -1;
    if (enemy.x <= 400) enemy.direction = 1;
  }

  // Toro colisiona enemigo
  if (bullActive) {
    bullX += bullSpeed;
    if (enemy.alive) {
      const colX = bullX + 150 > enemy.x && bullX < enemy.x + enemy.width;
      const colY = canvas.height - 40 > enemy.y;
      if (colX && colY) {
        enemy.exploding = true;
        enemy.explosionTimer = 90;
        enemy.alive = false;
      }
    }
    if (bullX > canvas.width) {
      bullActive = false;
      bullX = -200;
    }
  }

  // Tiempo de explosión enemigo
  if (enemy.exploding && enemy.explosionTimer > 0) {
    enemy.explosionTimer--;
  }

  // Invencibilidad por daño
  if (isInvincible) {
    invincibilityTimer--;
    if (invincibilityTimer <= 0) isInvincible = false;
  }

  // Colisión con enemigo
  if (enemy.alive && !isInvincible && !gameOver) {
    const brettRight = brettX + brettWidth;
    const brettBottom = brettY + brettHeight;
    const enemyRight = enemy.x + enemy.width;
    const enemyBottom = enemy.y + enemy.height;
    const colX = brettRight > enemy.x && brettX < enemyRight;
    const colY = brettBottom > enemy.y && brettY < enemyBottom;
    if (colX && colY) {
      lives--;
      isInvincible = true;
      invincibilityTimer = 120;
      if (lives <= 0) {
        gameOver = true;
        setTimeout(() => { showRetry = true; }, 2000);
      }
    }
  }

  drawGame();
  requestAnimationFrame(gameLoop);
}

// Movimiento teclado
window.addEventListener('keydown', (e) => {
  if (!gameStarted) return;
  if (e.key === 'ArrowLeft' || e.key === 'a') moveLeft = true;
  if (e.key === 'ArrowRight' || e.key === 'd') moveRight = true;
  if ((e.key === ' ' || e.key === 'w') && !isJumping) {
    isJumping = true;
    velocityY = -18;
  }
});
window.addEventListener('keyup', (e) => {
  if (e.key === 'ArrowLeft' || e.key === 'a') moveLeft = false;
  if (e.key === 'ArrowRight' || e.key === 'd') moveRight = false;
});
</script>
</body>
</html>
