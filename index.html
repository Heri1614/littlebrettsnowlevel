<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LittleBrett Snow Level</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    .controls {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 100px;
      background: rgba(0, 0, 0, 0.2);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }
    .controls img {
      width: 80px;
      height: 80px;
    }
    @media (min-width: 768px) {
      .controls img {
        width: 100px;
        height: 100px;
      }
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <div class="controls">
    <img src="btn_left.png" id="leftBtn" />
    <img src="btn_jump.png" id="jumpBtn" />
    <img src="btn_right.png" id="rightBtn" />
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const keys = {
      left: false,
      right: false,
      jump: false,
    };

    // Cargar imágenes
    const bg = new Image();
    bg.src = "bg_forest.png";

    const brettIdle = new Image();
    brettIdle.src = "brett_idle.png";

    const brettWalk1 = new Image();
    brettWalk1.src = "brett_walk1.png";

    const brettJump = new Image();
    brettJump.src = "brett_jump.png";

    const brettFall = new Image();
    brettFall.src = "brett_fall.png";

    const platformTall = new Image();
    platformTall.src = "PlatformTall.png";

    const platformSmall = new Image();
    platformSmall.src = "PlatformSmall.png";

    const coin = new Image();
    coin.src = "coin.png";

    const player = {
      x: 100,
      y: 400,
      width: 60,
      height: 60,
      dy: 0,
      grounded: false,
      sprite: brettIdle,
    };

    const gravity = 0.6;
    const jumpForce = -12;
    const moveSpeed = 5;

    const platforms = [
      { x: 0, y: 520, img: platformTall },
      { x: 150, y: 520, img: platformSmall },
      { x: 300, y: 520, img: platformTall },
      { x: 450, y: 520, img: platformSmall },
      { x: 600, y: 520, img: platformTall },
    ];

    const coins = [
      { x: 160, y: 460 },
      { x: 460, y: 460 },
    ];

    // Movimiento teclado
    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") keys.left = true;
      if (e.key === "ArrowRight") keys.right = true;
      if (e.key === " " || e.key === "ArrowUp") jump();
    });

    window.addEventListener("keyup", (e) => {
      if (e.key === "ArrowLeft") keys.left = false;
      if (e.key === "ArrowRight") keys.right = false;
    });

    function jump() {
      if (player.grounded) {
        player.dy = jumpForce;
        player.grounded = false;
      }
    }

    // Botones táctiles
    document.getElementById("leftBtn").addEventListener("touchstart", () => keys.left = true);
    document.getElementById("leftBtn").addEventListener("touchend", () => keys.left = false);
    document.getElementById("rightBtn").addEventListener("touchstart", () => keys.right = true);
    document.getElementById("rightBtn").addEventListener("touchend", () => keys.right = false);
    document.getElementById("jumpBtn").addEventListener("touchstart", jump);

    function update() {
      // Movimiento horizontal
      if (keys.left) player.x -= moveSpeed;
      if (keys.right) player.x += moveSpeed;

      // Gravedad
      player.y += player.dy;
      player.dy += gravity;

      // Colisiones con plataformas
      player.grounded = false;
      for (const p of platforms) {
        if (
          player.x < p.x + 100 &&
          player.x + player.width > p.x &&
          player.y + player.height > p.y &&
          player.y + player.height < p.y + 20 &&
          player.dy >= 0
        ) {
          player.y = p.y - player.height;
          player.dy = 0;
          player.grounded = true;
        }
      }

      // Animaciones
      if (!player.grounded) {
        player.sprite = player.dy < 0 ? brettJump : brettFall;
      } else if (keys.left || keys.right) {
        player.sprite = brettWalk1;
      } else {
        player.sprite = brettIdle;
      }

      // Limites pantalla
      if (player.x < 0) player.x = 0;
      if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(bg, 0, 0, canvas.width, canvas.height * 0.6);

      for (const p of platforms) {
        ctx.drawImage(p.img, p.x, p.y);
      }

      for (const c of coins) {
        ctx.drawImage(coin, c.x, c.y, 30, 30);
      }

      ctx.drawImage(player.sprite, player.x, player.y, player.width, player.height);
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    bg.onload = () => loop();
  </script>
</body>
</html>
